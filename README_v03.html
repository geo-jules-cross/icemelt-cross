<!DOCTYPE html><html><head><meta charset="utf-8"><style>@font-face {
  font-family: octicons-anchor;
  src: url(https://cdnjs.cloudflare.com/ajax/libs/octicons/4.4.0/font/octicons.woff) format('woff');
}

* {
    box-sizing: border-box;
}

body {
    width: 980px;
    margin-right: auto;
    margin-left: auto;
}

body .markdown-body {
    padding: 45px;
    border: 1px solid #ddd;
    border-radius: 3px;
    word-wrap: break-word;
}

pre {
    font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
}

.markdown-body {
  -webkit-text-size-adjust: 100%;
  text-size-adjust: 100%;
  color: #333;
  font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
  font-size: 16px;
  line-height: 1.6;
  word-wrap: break-word;
}

.markdown-body a {
  background-color: transparent;
}

.markdown-body a:active,
.markdown-body a:hover {
  outline: 0;
}

.markdown-body strong {
  font-weight: bold;
}

.markdown-body h1 {
  font-size: 2em;
  margin: 0.67em 0;
}

.markdown-body img {
  border: 0;
}

.markdown-body hr {
  box-sizing: content-box;
  height: 0;
}

.markdown-body pre {
  overflow: auto;
}

.markdown-body code,
.markdown-body kbd,
.markdown-body pre {
  font-family: monospace, monospace;
  font-size: 1em;
}

.markdown-body input {
  color: inherit;
  font: inherit;
  margin: 0;
}

.markdown-body html input[disabled] {
  cursor: default;
}

.markdown-body input {
  line-height: normal;
}

.markdown-body input[type="checkbox"] {
  box-sizing: border-box;
  padding: 0;
}

.markdown-body table {
  border-collapse: collapse;
  border-spacing: 0;
}

.markdown-body td,
.markdown-body th {
  padding: 0;
}

.markdown-body input {
  font: 13px / 1.4 Helvetica, arial, nimbussansl, liberationsans, freesans, clean, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
}

.markdown-body a {
  color: #4078c0;
  text-decoration: none;
}

.markdown-body a:hover,
.markdown-body a:active {
  text-decoration: underline;
}

.markdown-body hr {
  height: 0;
  margin: 15px 0;
  overflow: hidden;
  background: transparent;
  border: 0;
  border-bottom: 1px solid #ddd;
}

.markdown-body hr:before {
  display: table;
  content: "";
}

.markdown-body hr:after {
  display: table;
  clear: both;
  content: "";
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 15px;
  margin-bottom: 15px;
  line-height: 1.1;
}

.markdown-body h1 {
  font-size: 30px;
}

.markdown-body h2 {
  font-size: 21px;
}

.markdown-body h3 {
  font-size: 16px;
}

.markdown-body h4 {
  font-size: 14px;
}

.markdown-body h5 {
  font-size: 12px;
}

.markdown-body h6 {
  font-size: 11px;
}

.markdown-body blockquote {
  margin: 0;
}

.markdown-body ul,
.markdown-body ol {
  padding: 0;
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body ol ol,
.markdown-body ul ol {
  list-style-type: lower-roman;
}

.markdown-body ul ul ol,
.markdown-body ul ol ol,
.markdown-body ol ul ol,
.markdown-body ol ol ol {
  list-style-type: lower-alpha;
}

.markdown-body dd {
  margin-left: 0;
}

.markdown-body code {
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  font-size: 12px;
}

.markdown-body pre {
  margin-top: 0;
  margin-bottom: 0;
  font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
}

.markdown-body .select::-ms-expand {
  opacity: 0;
}

.markdown-body .octicon {
  font: normal normal normal 16px/1 octicons-anchor;
  display: inline-block;
  text-decoration: none;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.markdown-body .octicon-link:before {
  content: '\f05c';
}

.markdown-body:before {
  display: table;
  content: "";
}

.markdown-body:after {
  display: table;
  clear: both;
  content: "";
}

.markdown-body>*:first-child {
  margin-top: 0 !important;
}

.markdown-body>*:last-child {
  margin-bottom: 0 !important;
}

.markdown-body a:not([href]) {
  color: inherit;
  text-decoration: none;
}

.markdown-body .anchor {
  display: inline-block;
  padding-right: 2px;
  margin-left: -18px;
}

.markdown-body .anchor:focus {
  outline: none;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 1em;
  margin-bottom: 16px;
  font-weight: bold;
  line-height: 1.4;
}

.markdown-body h1 .octicon-link,
.markdown-body h2 .octicon-link,
.markdown-body h3 .octicon-link,
.markdown-body h4 .octicon-link,
.markdown-body h5 .octicon-link,
.markdown-body h6 .octicon-link {
  color: #000;
  vertical-align: middle;
  visibility: hidden;
}

.markdown-body h1:hover .anchor,
.markdown-body h2:hover .anchor,
.markdown-body h3:hover .anchor,
.markdown-body h4:hover .anchor,
.markdown-body h5:hover .anchor,
.markdown-body h6:hover .anchor {
  text-decoration: none;
}

.markdown-body h1:hover .anchor .octicon-link,
.markdown-body h2:hover .anchor .octicon-link,
.markdown-body h3:hover .anchor .octicon-link,
.markdown-body h4:hover .anchor .octicon-link,
.markdown-body h5:hover .anchor .octicon-link,
.markdown-body h6:hover .anchor .octicon-link {
  visibility: visible;
}

.markdown-body h1 {
  padding-bottom: 0.3em;
  font-size: 2.25em;
  line-height: 1.2;
  border-bottom: 1px solid #eee;
}

.markdown-body h1 .anchor {
  line-height: 1;
}

.markdown-body h2 {
  padding-bottom: 0.3em;
  font-size: 1.75em;
  line-height: 1.225;
  border-bottom: 1px solid #eee;
}

.markdown-body h2 .anchor {
  line-height: 1;
}

.markdown-body h3 {
  font-size: 1.5em;
  line-height: 1.43;
}

.markdown-body h3 .anchor {
  line-height: 1.2;
}

.markdown-body h4 {
  font-size: 1.25em;
}

.markdown-body h4 .anchor {
  line-height: 1.2;
}

.markdown-body h5 {
  font-size: 1em;
}

.markdown-body h5 .anchor {
  line-height: 1.1;
}

.markdown-body h6 {
  font-size: 1em;
  color: #777;
}

.markdown-body h6 .anchor {
  line-height: 1.1;
}

.markdown-body p,
.markdown-body blockquote,
.markdown-body ul,
.markdown-body ol,
.markdown-body dl,
.markdown-body table,
.markdown-body pre {
  margin-top: 0;
  margin-bottom: 16px;
}

.markdown-body hr {
  height: 4px;
  padding: 0;
  margin: 16px 0;
  background-color: #e7e7e7;
  border: 0 none;
}

.markdown-body ul,
.markdown-body ol {
  padding-left: 2em;
}

.markdown-body ul ul,
.markdown-body ul ol,
.markdown-body ol ol,
.markdown-body ol ul {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body li>p {
  margin-top: 16px;
}

.markdown-body dl {
  padding: 0;
}

.markdown-body dl dt {
  padding: 0;
  margin-top: 16px;
  font-size: 1em;
  font-style: italic;
  font-weight: bold;
}

.markdown-body dl dd {
  padding: 0 16px;
  margin-bottom: 16px;
}

.markdown-body blockquote {
  padding: 0 15px;
  color: #777;
  border-left: 4px solid #ddd;
}

.markdown-body blockquote>:first-child {
  margin-top: 0;
}

.markdown-body blockquote>:last-child {
  margin-bottom: 0;
}

.markdown-body table {
  display: block;
  width: 100%;
  overflow: auto;
  word-break: normal;
  word-break: keep-all;
}

.markdown-body table th {
  font-weight: bold;
}

.markdown-body table th,
.markdown-body table td {
  padding: 6px 13px;
  border: 1px solid #ddd;
}

.markdown-body table tr {
  background-color: #fff;
  border-top: 1px solid #ccc;
}

.markdown-body table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

.markdown-body img {
  max-width: 100%;
  box-sizing: content-box;
  background-color: #fff;
}

.markdown-body code {
  padding: 0;
  padding-top: 0.2em;
  padding-bottom: 0.2em;
  margin: 0;
  font-size: 85%;
  background-color: rgba(0,0,0,0.04);
  border-radius: 3px;
}

.markdown-body code:before,
.markdown-body code:after {
  letter-spacing: -0.2em;
  content: "\00a0";
}

.markdown-body pre>code {
  padding: 0;
  margin: 0;
  font-size: 100%;
  word-break: normal;
  white-space: pre;
  background: transparent;
  border: 0;
}

.markdown-body .highlight {
  margin-bottom: 16px;
}

.markdown-body .highlight pre,
.markdown-body pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
  background-color: #f7f7f7;
  border-radius: 3px;
}

.markdown-body .highlight pre {
  margin-bottom: 0;
  word-break: normal;
}

.markdown-body pre {
  word-wrap: normal;
}

.markdown-body pre code {
  display: inline;
  max-width: initial;
  padding: 0;
  margin: 0;
  overflow: initial;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0;
}

.markdown-body pre code:before,
.markdown-body pre code:after {
  content: normal;
}

.markdown-body kbd {
  display: inline-block;
  padding: 3px 5px;
  font-size: 11px;
  line-height: 10px;
  color: #555;
  vertical-align: middle;
  background-color: #fcfcfc;
  border: solid 1px #ccc;
  border-bottom-color: #bbb;
  border-radius: 3px;
  box-shadow: inset 0 -1px 0 #bbb;
}

.markdown-body .pl-c {
  color: #969896;
}

.markdown-body .pl-c1,
.markdown-body .pl-s .pl-v {
  color: #0086b3;
}

.markdown-body .pl-e,
.markdown-body .pl-en {
  color: #795da3;
}

.markdown-body .pl-s .pl-s1,
.markdown-body .pl-smi {
  color: #333;
}

.markdown-body .pl-ent {
  color: #63a35c;
}

.markdown-body .pl-k {
  color: #a71d5d;
}

.markdown-body .pl-pds,
.markdown-body .pl-s,
.markdown-body .pl-s .pl-pse .pl-s1,
.markdown-body .pl-sr,
.markdown-body .pl-sr .pl-cce,
.markdown-body .pl-sr .pl-sra,
.markdown-body .pl-sr .pl-sre {
  color: #183691;
}

.markdown-body .pl-v {
  color: #ed6a43;
}

.markdown-body .pl-id {
  color: #b52a1d;
}

.markdown-body .pl-ii {
  background-color: #b52a1d;
  color: #f8f8f8;
}

.markdown-body .pl-sr .pl-cce {
  color: #63a35c;
  font-weight: bold;
}

.markdown-body .pl-ml {
  color: #693a17;
}

.markdown-body .pl-mh,
.markdown-body .pl-mh .pl-en,
.markdown-body .pl-ms {
  color: #1d3e81;
  font-weight: bold;
}

.markdown-body .pl-mq {
  color: #008080;
}

.markdown-body .pl-mi {
  color: #333;
  font-style: italic;
}

.markdown-body .pl-mb {
  color: #333;
  font-weight: bold;
}

.markdown-body .pl-md {
  background-color: #ffecec;
  color: #bd2c00;
}

.markdown-body .pl-mi1 {
  background-color: #eaffea;
  color: #55a532;
}

.markdown-body .pl-mdr {
  color: #795da3;
  font-weight: bold;
}

.markdown-body .pl-mo {
  color: #1d3e81;
}

.markdown-body kbd {
  display: inline-block;
  padding: 3px 5px;
  font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
  line-height: 10px;
  color: #555;
  vertical-align: middle;
  background-color: #fcfcfc;
  border: solid 1px #ccc;
  border-bottom-color: #bbb;
  border-radius: 3px;
  box-shadow: inset 0 -1px 0 #bbb;
}

.markdown-body .plan-price-unit {
  color: #767676;
  font-weight: normal;
}

.markdown-body .task-list-item {
  list-style-type: none;
}

.markdown-body .task-list-item+.task-list-item {
  margin-top: 3px;
}

.markdown-body .task-list-item input {
  margin: 0 0.35em 0.25em -1.6em;
  vertical-align: middle;
}

.markdown-body .plan-choice {
  padding: 15px;
  padding-left: 40px;
  display: block;
  border: 1px solid #e0e0e0;
  position: relative;
  font-weight: normal;
  background-color: #fafafa;
}

.markdown-body .plan-choice.open {
  background-color: #fff;
}

.markdown-body .plan-choice.open .plan-choice-seat-breakdown {
  display: block;
}

.markdown-body .plan-choice-free {
  border-radius: 3px 3px 0 0;
}

.markdown-body .plan-choice-paid {
  border-radius: 0 0 3px 3px;
  border-top: 0;
  margin-bottom: 20px;
}

.markdown-body .plan-choice-radio {
  position: absolute;
  left: 15px;
  top: 18px;
}

.markdown-body .plan-choice-exp {
  color: #999;
  font-size: 12px;
  margin-top: 5px;
}

.markdown-body .plan-choice-seat-breakdown {
  margin-top: 10px;
  display: none;
}

.markdown-body :checked+.radio-label {
  z-index: 1;
  position: relative;
  border-color: #4078c0;
}

@media print {
  body .markdown-body {
    padding: 0;
    border: none;
  }
}
</style><title>README_v03</title></head><body><article class="markdown-body"><h1>
<a id="user-content-icemelt-model-v03" class="anchor" href="#icemelt-model-v03" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ICEMELT model (v03)</h1>
<p>Repository for ICEMELT fortran model and pre- and post- processing scripts. Created to track modifications (in-lieu of a branch) made to Hoffman et al ICEMELT version by Julian Cross.</p>
<p>This FORTRAN code simulates the temperature and water content within snow and ice in response to the surface energy balance and penetration of solar radiation into the snow and ice.</p>
<p><strong>Code:</strong> <code>icemelt_albedo_jmc_v03.f95</code><br>
<strong>File Location:</strong>
<code>I:\Antarctica_Julian\icemelt-cross</code><br>
<strong>Date of README:</strong> 28 October 2018<br>
<strong>Author of README:</strong> Julian Cross</p>
<h3>
<a id="user-content-table-of-contents" class="anchor" href="#table-of-contents" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Table of Contents</h3>
<ol>
<li><a href="#version_history">Version History</a></li>
<li><a href="#compiling">Compiling the Model</a></li>
<li><a href="#running">Running the Model</a></li>
<li><a href="#folders">Folder Structure</a></li>
<li><a href="#parameters">Input Parameters</a></li>
<li><a href="#input_files">Input Files</a></li>
<li><a href="#output_files">Output Files</a></li>
<li><a href="#postprocess">Post-processing Scripts</a></li>
<li><a href="#attribution">Attribution</a></li>
<li><a href="#appendix">Appendix</a></li>
</ol>
<hr>
<h2>
<a id="user-content-version-history" class="anchor" href="#version-history" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a name="user-content-version_history"></a>Version History</h2>
<h5>
<a id="user-content-previous-versions" class="anchor" href="#previous-versions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Previous versions:</h5>
<ul>
<li>
<code>icemelt_8hr_Qc_spatial_xy_mc_drain.f</code> (v00)</li>
<li>
<code>icemelt_hoffman_v01.f95</code> (v01)</li>
<li>
<code>icemelt_spatial_cross_v02.f95</code> (v02)</li>
</ul>
<h5>
<a id="user-content-changes-from-previous-version" class="anchor" href="#changes-from-previous-version" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Changes from previous version:</h5>
<ul>
<li>
<strong>September 2017</strong>: In <code>elseif (nz.eq.71) then</code>, FZ changed <code>delta(71)</code> to <code>delta(70)</code> due to error flag when compiling.  This can be undone if the user wants to run the code using <code>nz = 71</code>.</li>
<li>
<strong>October 2017:</strong> FZ reformatted fixed-format v00 (.f) to free-format v01 (.f95).</li>
<li>
<strong>November 2017:</strong> JC made adjustments to <code>namelist.input</code> and output handling.</li>
<li>
<strong>March 2018:</strong> JC and FZ removed some portions of functional commented-out code from previous version added by Ebnet or Hoffman.  We did not remove their descriptive comments.</li>
<li>
<strong>June 2018:</strong> JC developed scripts to run ICEMELT on Coeus Cluster.</li>
<li>
<strong>October 2018:</strong> JC added new albedo method to account for spatial variability of albedo.</li>
</ul>
<h2>
<a id="user-content-compiling-the-model" class="anchor" href="#compiling-the-model" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a name="user-content-compiling"></a>Compiling the Model</h2>
<h5>
<a id="user-content-fortran-format" class="anchor" href="#fortran-format" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>FORTRAN format:</h5>
<ul>
<li>The original code was written in FORTRAN 77 (fixed-form).</li>
<li>Modified version of code was translated to FORTRAN 95 (free-form).</li>
<li>This verison should be compiled with any FORTRAN 90/95 compiler.</li>
</ul>
<h5>
<a id="user-content-operating-system" class="anchor" href="#operating-system" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Operating System:</h5>
<p>The <code>os_info.inc</code> file allows the code to be compiled on DOS or linux operating systems.</p>
<ul>
<li>It must be in the icemelt directory (see Model Folder Structure section below).</li>
<li>It contains shell commands written for each OS.</li>
</ul>
<h5>
<a id="user-content-linux-compiling" class="anchor" href="#linux-compiling" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Linux Compiling:</h5>
<p>An example of a compile shell command using GCC (GNU Fortran) 7.2.0<br>
<code>gfortran -o ./icemelt ./icemelt_albedo_jmc_v03.f95</code></p>
<p>In this command the <code>-o</code> option specifies that the <code>./icemelt_albedo_jmc_v03.f95</code> program is compiled to an executable object at <code>./icemelt</code> (rather than the default <code>a.out</code>). This executable is used in further shell scripts to run the model.</p>
<h2>
<a id="user-content-running-the-model" class="anchor" href="#running-the-model" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a name="user-content-running"></a>Running the Model</h2>
<h3>
<a id="user-content-on-the-herarcpdxedu-server" class="anchor" href="#on-the-herarcpdxedu-server" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>On the hera.rc.pdx.edu Server</h3>
<ul>
<li>PSU Research Computing (RC) infrastructure allows for computing on a remote Linux server.</li>
<li>Permisions need to be given by OIT for access to these servers.</li>
</ul>
<h5>
<a id="user-content-step-1-logging-into-the-rc-server" class="anchor" href="#step-1-logging-into-the-rc-server" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Step 1: Logging into the RC Server</h5>
<ul>
<li>These servers can be accessed via an SSH protocol (from a linux shell or from Putty, for example).</li>
<li>In a Linux shell, SSH into the server: <code>ssh USERNAME@rc.pdx.edu</code>
</li>
<li>Once a PSU odin password is provided, you will be connected to the research server.</li>
</ul>
<h5>
<a id="user-content-step-2-setting-up-the-working-environment" class="anchor" href="#step-2-setting-up-the-working-environment" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Step 2: Setting up the working environment</h5>
<ul>
<li>Once connected to the <code>rc.pdx.edu</code> server, files can be copied from <code>I:\Antarctica_Julian\icemelt-cross</code> via SSH Secure Copy.</li>
<li>For example, to copy the icemelt directory from the <code>I:</code> drive to the current directory use:<br>
<code>scp -r USERNAME@sftp.myfiles.pdx.edu:Idrive-ResourcesFolder/Research/Shares/antarctica/WORKING_DIRECTORY .</code>
</li>
<li>You may need to load the correct modules in order for code to be correctly compiled, see section below on setting up the working environment.</li>
</ul>
<h5>
<a id="user-content-step-3-running-the-model" class="anchor" href="#step-3-running-the-model" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Step 3: Running the model</h5>
<ul>
<li>If all the required <a href="#input_files">input files</a> and the correct <a href="#folders">folder structure</a> are present, the model can be compiled and run:</li>
</ul>
<div class="highlight highlight-source-shell"><pre>gfortran -o ./icemelt ./icemelt_albedo_jmc_v03.f95
chmod u+x icemelt
./icemelt</pre></div>
<h5>
<a id="user-content-step-4-check-the-results-and-transfer-files-back-to-local" class="anchor" href="#step-4-check-the-results-and-transfer-files-back-to-local" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Step 4: Check the results and transfer files back to local</h5>
<ul>
<li>Output files and logs can be copied back to the I:drive for post-processing using the inverse of the <code>scp</code> command above:<br>
<code>scp -r output USERNAME@sftp.myfiles.pdx.edu:Idrive-ResourcesFolder/Research/Shares/antarctica/WORKING_DIRECTORY</code>
</li>
<li>
<strong>NOTE:</strong> A full run of the spatial model should never be run against an executable or data stored on the <code>I:drive</code>. Make sure to transfer necesary data and files to a working directory on the RC server.</li>
</ul>
<h3>
<a id="user-content-on-the-coeusrcpdxedu-cluster" class="anchor" href="#on-the-coeusrcpdxedu-cluster" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>On the coeus.rc.pdx.edu Cluster</h3>
<ul>
<li>PSU Research Computing (RC) infrastructure also includes a high-powered computing cluster known as Coeus.</li>
<li>For more information on how to get access to the Coeus Cluster see <a href="https://www.pdx.edu/oit/research-computing" rel="nofollow">here</a>.</li>
<li>For more information on RC infrastructure see these two videos <a href="https://media.pdx.edu/media/MSRP-Research_Computing_Part_1/0_7a3563h2" rel="nofollow">here</a> and <a href="https://media.pdx.edu/media/MSRP-Research_Computing_Part_2/0_06cog3h7" rel="nofollow">here</a>.</li>
<li>For a more elaborate guide to using the Coeus Cluster see this Google Doc <a href="https://docs.google.com/document/d/1OE8ZU_QyMda7pznTBQx_uvBGiSvuHje6v255qMO3j_I/edit#" rel="nofollow">here</a>.</li>
<li>
<strong>NOTE:</strong> You need to be connected to the campus VPN to ssh to the Cluster. From off-campus this can be accomplished with Cisco AnyConnect. For instructions see <a href="https://www.pdx.edu/oit/virtual-private-network-vpn" rel="nofollow">here</a>.</li>
</ul>
<h5>
<a id="user-content-step-1-logging-into-the-cluster" class="anchor" href="#step-1-logging-into-the-cluster" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Step 1: Logging into the Cluster</h5>
<ul>
<li>Just like the other research servers (e.g. Hera), the Coeus Cluster can be accessed via an SSH conection.</li>
<li>In a Linux shell, SSH into the cluster login node:<br>
<code>ssh USERNAME@login1.coeus.rc.pdx.edu</code> or <code>@login2.coeus.rc.pdx.edu</code>
</li>
<li>Once a PSU odin password is provided, you will be connected to the cluster.</li>
</ul>
<h5>
<a id="user-content-step-2-setting-up-the-working-environment-1" class="anchor" href="#step-2-setting-up-the-working-environment-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Step 2: Setting up the working environment</h5>
<ul>
<li>Files can be copied from <code>I:\Antarctica_Julian\icemelt-cross</code> via SSH Secure Copy.</li>
<li>For example, to copy the icemelt directory from the <code>I:</code> drive to the current directory use:<br>
<code>scp -r USERNAME@sftp.myfiles.pdx.edu:Idrive-ResourcesFolder/Research/Shares/antarctica/WORKING_DIRECTORY .</code>
</li>
<li>In order to compile and run certain programs, modules containing the necessary compilers and software (e.g. GCC, Python, FORTRAN, R) need to be loaded into the working environment on the Cluster.</li>
<li>The modules that are available to load can be listed with <code>module avail</code>:</li>
</ul>
<div class="highlight highlight-text-shell-session"><pre><span class="pl-c1">------------------------------ /usr/share/Modules/modulefiles -------------------------------</span>
<span class="pl-c1">dot         module-git  module-info modules     null        use.own</span>

<span class="pl-c1">------------------------------------- /etc/modulefiles --------------------------------------</span>
<span class="pl-c1">mpi/openmpi-x86_64</span>

<span class="pl-c1">------------------------------------- /act/modulefiles --------------------------------------</span>
<span class="pl-c1">gcc-6.3.0</span>
<span class="pl-c1">gcc-7.2.0</span>
<span class="pl-c1">General/matlab/R2018a</span>
<span class="pl-c1">General/matlab2017a</span>
<span class="pl-c1">mvapich2-2.2/gcc-6.3.0</span>
<span class="pl-c1">mvapich2-2.2/gcc-7.2.0</span>
<span class="pl-c1">openmpi-2.0/gcc-7.2.0</span>
<span class="pl-c1">Python/3.6.4/gcc-6.3.0</span>
<span class="pl-c1">R/3.2.1/mvapich2-2.2-psm/gcc-7.2.0</span>
<span class="pl-c1">R/3.4.0/gcc6.3</span></pre></div>
<ul>
<li>To list the modules currently loaded, use <code>module list</code>
</li>
<li>To load a module use <code>module load NAME</code>
</li>
<li>
<strong>NOTE:</strong> Modules can be loaded from inside a run/batch script, see below.</li>
</ul>
<h5>
<a id="user-content-step-3-running-the-model-with-an-sbatch-script" class="anchor" href="#step-3-running-the-model-with-an-sbatch-script" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Step 3: Running the model with an SBATCH script</h5>
<ul>
<li>The Coeus Cluster uses a program called SLURM Workload Manager with OpenMPI (message passing interface) to schedule processes and manage processes on each node of the cluster.</li>
<li>More information on SLURM see <a href="https://slurm.schedmd.com/quickstart.html" rel="nofollow">here</a>.</li>
<li>To schedule processes on the Cluster through SLURM, a SBATCH script needs to be used. This script is basically a bash or <code>.sh</code> script with some lines of code that are unique to the SLURM program. See code example below:</li>
</ul>
<div class="highlight highlight-source-shell"><pre><span class="pl-c"><span class="pl-c">#!</span>/bin/bash</span>
<span class="pl-c"><span class="pl-c">#</span> script to run all surfaces in ICEMELT in parallel on Coeus Cluster</span>
<span class="pl-c"><span class="pl-c">#</span></span>
<span class="pl-c"><span class="pl-c">#</span> SLURM parallel commands</span>
<span class="pl-c"><span class="pl-c">#</span>SBATCH --job-name=icemelt-all</span>
<span class="pl-c"><span class="pl-c">#</span>SBATCH --output=logs/icemelt-%A.log</span>
<span class="pl-c"><span class="pl-c">#</span></span>
<span class="pl-c"><span class="pl-c">#</span> mail alert at start, end and abortion of execution</span>
<span class="pl-c"><span class="pl-c">#</span>SBATCH --mail-type=ALL</span>
<span class="pl-c"><span class="pl-c">#</span></span>
<span class="pl-c"><span class="pl-c">#</span> send mail to this address</span>
<span class="pl-c"><span class="pl-c">#</span>SBATCH --mail-user=jucross@pdx.edu</span>
<span class="pl-c"><span class="pl-c">#</span></span>
<span class="pl-c"><span class="pl-c">#</span> load cluster module</span>
module purge
module load gcc-7.2.0

<span class="pl-c"><span class="pl-c">#</span> compile ICEMELT</span>
<span class="pl-c"><span class="pl-c">#</span> gfortran -g -o ./icemelt ./icemelt_spatial_jmc.f95</span>

<span class="pl-c"><span class="pl-c">#</span>## run ICEMELT with for loop and SLURM srun</span>

<span class="pl-c"><span class="pl-c">#</span> base commands for running the model</span>
NL=<span class="pl-s"><span class="pl-pds">"</span>./namelist/namelist.input<span class="pl-pds">"</span></span>
CMD=<span class="pl-s"><span class="pl-pds">"</span>./icemelt<span class="pl-pds">"</span></span>
runname=<span class="pl-s"><span class="pl-pds">`</span>grep runnametext <span class="pl-smi">$NL</span> <span class="pl-k">|</span> cut -f 2 -d <span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\"</span><span class="pl-pds">"</span></span><span class="pl-pds">`</span></span>

<span class="pl-c1">echo</span> using runnametext=<span class="pl-smi">$runname</span>

<span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">"</span>running smooth surface run<span class="pl-pds">"</span></span>
cp <span class="pl-smi">$NL</span> <span class="pl-smi">$NL</span>.smooth

<span class="pl-c"><span class="pl-c">#</span> run smooth</span>
<span class="pl-smi">$CMD</span> <span class="pl-smi">$NL</span>.smooth <span class="pl-k">&amp;</span>

<span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">"</span>setup &amp; run basin wall<span class="pl-pds">"</span></span>
cp <span class="pl-smi">$NL</span> <span class="pl-smi">$NL</span>.bwall
sed -i.SEDBACKUP <span class="pl-s"><span class="pl-pds">"</span>s/.*z_0.*/z_0 = 1/<span class="pl-pds">"</span></span> <span class="pl-smi">$NL</span>.bwall
sed -i.SEDBACKUP <span class="pl-s"><span class="pl-pds">"</span>s/.*tempadd.*/tempadd = 0.5/<span class="pl-pds">"</span></span> <span class="pl-smi">$NL</span>.bwall
sed -i.SEDBACKUP <span class="pl-s"><span class="pl-pds">"</span>s/.*windmult.*/windmult = 0.67/<span class="pl-pds">"</span></span> <span class="pl-smi">$NL</span>.bwall
sed -i.SEDBACKUP <span class="pl-s"><span class="pl-pds">"</span>s/.*albedo_offset.*/albedo_offset = -0.065/<span class="pl-pds">"</span></span> <span class="pl-smi">$NL</span>.bwall
sed -i.SEDBACKUP <span class="pl-s"><span class="pl-pds">"</span>s/.*runnametext.*/runnametext = <span class="pl-cce">\"</span><span class="pl-smi">$runname</span>-bwall<span class="pl-cce">\"</span>/<span class="pl-pds">"</span></span> <span class="pl-smi">$NL</span>.bwall

<span class="pl-c"><span class="pl-c">#</span> run basin wall</span>
<span class="pl-smi">$CMD</span> <span class="pl-smi">$NL</span>.bwall <span class="pl-k">&amp;</span>

<span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">"</span>setup &amp; run basin floor<span class="pl-pds">"</span></span>
cp <span class="pl-smi">$NL</span> <span class="pl-smi">$NL</span>.bfloor
sed -i.SEDBACKUP <span class="pl-s"><span class="pl-pds">"</span>s/.*z_0.*/z_0 = 1/<span class="pl-pds">"</span></span> <span class="pl-smi">$NL</span>.bfloor
sed -i.SEDBACKUP <span class="pl-s"><span class="pl-pds">"</span>s/.*tempadd.*/tempadd = 1.5/<span class="pl-pds">"</span></span> <span class="pl-smi">$NL</span>.bfloor
sed -i.SEDBACKUP <span class="pl-s"><span class="pl-pds">"</span>s/.*windmult.*/windmult = 0.33/<span class="pl-pds">"</span></span> <span class="pl-smi">$NL</span>.bfloor
sed -i.SEDBACKUP <span class="pl-s"><span class="pl-pds">"</span>s/.*albedo_offset.*/albedo_offset = -0.17/<span class="pl-pds">"</span></span> <span class="pl-smi">$NL</span>.bfloor
sed -i.SEDBACKUP <span class="pl-s"><span class="pl-pds">"</span>s/.*runnametext.*/runnametext = <span class="pl-cce">\"</span><span class="pl-smi">$runname</span>-bfloor<span class="pl-cce">\"</span>/<span class="pl-pds">"</span></span> <span class="pl-smi">$NL</span>.bfloor

<span class="pl-c"><span class="pl-c">#</span> run basin floor</span>
<span class="pl-smi">$CMD</span> <span class="pl-smi">$NL</span>.bfloor <span class="pl-k">&amp;</span>
 
<span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">"</span>setup &amp; run cliff<span class="pl-pds">"</span></span>
cp <span class="pl-smi">$NL</span> <span class="pl-smi">$NL</span>.cliff
sed -i.SEDBACKUP <span class="pl-s"><span class="pl-pds">"</span>s/.*z_0.*/z_0 = 0.1/<span class="pl-pds">"</span></span> <span class="pl-smi">$NL</span>.cliff
sed -i.SEDBACKUP <span class="pl-s"><span class="pl-pds">"</span>s/.*glacnum.*/glacnum = -1/<span class="pl-pds">"</span></span> <span class="pl-smi">$NL</span>.cliff
sed -i.SEDBACKUP <span class="pl-s"><span class="pl-pds">"</span>s/.*runnametext.*/runnametext = <span class="pl-cce">\"</span><span class="pl-smi">$runname</span>-cliff<span class="pl-cce">\"</span>/<span class="pl-pds">"</span></span> <span class="pl-smi">$NL</span>.cliff

<span class="pl-c"><span class="pl-c">#</span> run cliff</span>
<span class="pl-smi">$CMD</span> <span class="pl-smi">$NL</span>.cliff <span class="pl-k">&amp;</span>

<span class="pl-c1">wait</span>

<span class="pl-c"><span class="pl-c">#</span> rm sed*</span>
<span class="pl-c"><span class="pl-c">#</span> rm *.SEDBACKUP</span>

<span class="pl-c"><span class="pl-c">#</span> end</span></pre></div>
<ul>
<li>
<p>In the code above, the <code>#SBATCH</code> command is used to setup the SLURM job. Note that the <code>#SBATCH</code> (correct) is different than <code># SBATCH</code> (incorrect).</p>
<ul>
<li>
<code>#SBATCH --job-name=icemelt</code> sets the job name.</li>
<li>
<code>#SBATCH --ntasks-per-node=1</code> sets the number of tasks per node (-n=1 is the default and synonymous to --ntasks-per-node=1)</li>
<li>
<code>#SBATCH --partition medium</code> sets the jobs to run on the medium partition of the Coeus Cluster, which is meant for processes that take between 1-3 days.</li>
<li>
<code>#SBATCH --output=logs/albedo-%A.log</code> sets the output to a <code>.log</code> text file where <code>%A</code> is the job ID.</li>
<li>
<code>#SBATCH --mail-type=ALL</code> and <code>#SBATCH --mail-user=USERNAME@pdx.edu</code> control how SLURM sends notifications.</li>
<li>
<code>module load gcc-7.2.0</code> loads the GCC 7.2.0 compiler.</li>
<li>
<code>./icemelt ./namelist.input</code> runs the model.</li>
</ul>
</li>
<li>
<p>This SBATCH job submit script can be run by calling the sbatch command:</p>
</li>
</ul>
<div class="highlight highlight-source-shell"><pre>chmod u+x run_cluster.sh
sbatch run_cluster.sh</pre></div>
<ul>
<li>If the job was succesfully submitted:</li>
</ul>
<div class="highlight highlight-text-shell-session"><pre><span class="pl-c1">Submitted batch job 42776</span></pre></div>
<h5>
<a id="user-content-step-4-check-the-results-and-transfer-files-back-to-local-1" class="anchor" href="#step-4-check-the-results-and-transfer-files-back-to-local-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Step 4: Check the results and transfer files back to local</h5>
<ul>
<li>
<code>squeue -u USERNAME</code> can be used to check if the job is running (use <code>-u USERNAME</code> option to show only jobs submitted by you). Or to see the queue of jobs to be run.</li>
</ul>
<div class="highlight highlight-text-shell-session"><pre><span class="pl-c1">    JOBID PARTITION     NAME     USER ST       TIME  NODES NODELISTREASON)</span>
<span class="pl-c1">     42776_[7]    medium  icemelt  jucross PD       0:00      1 (Resources)</span>
<span class="pl-c1">       42776_1    medium  icemelt  jucross  R       0:06      1 compute033</span>
<span class="pl-c1">       42776_2    medium  icemelt  jucross  R       0:06      1 compute021</span>
<span class="pl-c1">       42776_3    medium  icemelt  jucross  R       0:06      1 compute024</span>
<span class="pl-c1">       42776_4    medium  icemelt  jucross  R       0:06      1 compute026</span>
<span class="pl-c1">       42776_5    medium  icemelt  jucross  R       0:06      1 compute029</span>
<span class="pl-c1">       42776_6    medium  icemelt  jucross  R       0:06      1 compute031</span></pre></div>
<ul>
<li>
<code>scancel JOBID</code> can be used to cancel a job.</li>
<li>Output files and logs can be copied back to the I:drive for post-processing using the inverse of the <code>scp</code> command above:<br>
<code>scp -r output USERNAME@sftp.myfiles.pdx.edu:Idrive-ResourcesFolder/Research/Shares/antarctica/WORKING_DIRECTORY</code><br>
and<br>
<code>scp -r logs USERNAME@sftp.myfiles.pdx.edu:Idrive-ResourcesFolder/Research/Shares/antarctica/WORKING_DIRECTORY</code>
</li>
<li>
<strong>NOTE:</strong> A full run of the spatial model should never be run against an executable or data stored on the <code>I:drive</code>. Make sure to transfer necesary data and files to a working directory on the Cluster.</li>
</ul>
<h2>
<a id="user-content-folder-structure" class="anchor" href="#folder-structure" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a name="user-content-folders"></a>Folder Structure</h2>
<p>The model depends on several files and directories that need to reside in the same working directory. These files include <code>os_info.inc</code>, <code>namelist.input</code> and the files described below in the 'Input Files' section. Additionally an <code>output</code> directory needs to exist. The folder structure below is required for a succesful spatial run of the model:</p>
<div class="highlight highlight-source-shell"><pre>├───icemelt-working-dir
│       icemelt
│       icemelt_spatial_jmc.f95
│       os_info.inc
│       namelist.input
│       README.txt
│
├───────output
├───────logs
├───────input_cliff
│               XXXYYY.bin
│               ...
│
├───────input
│               XXXYYY.bin
│               ...
│               9513_alb.clf
│               9513_alb.AVG
│               9513_alb.CAA
│               9513_alb.TAR
│               BFS_stn.bin
│               CAA_stn.bin
│               COH_stn.bin
│               HOD_stn.bin
│               LHC_stn.bin
│               TAR_stn.bin
│               hoe_pa.bin
│               icetempinit2008good.txt
│               mie.dat
│               solar.dat
│               specalb.dat
│               tv_basins_cliff.txt
│               tv_basins_surface.txt
│               tv_dem250.txt
│               tv_landcovermetstake.txt
│               tv_landcover_met.txt
│               T_avg_all.txt
│               T_avg_cliff.txt
└────────────── T_avg_surf.txt</pre></div>
<h2>
<a id="user-content-input-parameters" class="anchor" href="#input-parameters" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a name="user-content-parameters"></a>Input Parameters</h2>
<p>Model parameters controlling both environmental variables and run settings are specified in the <code>namelist.input</code> file (a FORTRAN file formatted as below).</p>
<div class="highlight highlight-source-fortran-modern"><pre>&amp;params
<span class="pl-c"><span class="pl-c">!</span> required parameters</span>
    glacnum <span class="pl-k">=</span> <span class="pl-c1">0</span> <span class="pl-c"><span class="pl-c">!</span> case</span>
    z_0 <span class="pl-k">=</span> <span class="pl-c1">0.05</span> <span class="pl-c"><span class="pl-c">!</span> mm</span>
    dz1 <span class="pl-k">=</span> <span class="pl-c1">0.0025</span> <span class="pl-c"><span class="pl-c">!</span> m</span>
    n_snowgrain_radius <span class="pl-k">=</span> <span class="pl-c1">9</span> <span class="pl-c"><span class="pl-c">!</span> index</span>
    runmin <span class="pl-k">=</span> <span class="pl-c1">10</span> <span class="pl-c"><span class="pl-c">!</span> index</span>
    runmax <span class="pl-k">=</span> <span class="pl-c1">82</span> <span class="pl-c"><span class="pl-c">!</span> index</span>
    runnametext <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>TEST<span class="pl-pds">"</span></span>
<span class="pl-c"><span class="pl-c">!</span> optional adjustments to met data</span>
    tempadd <span class="pl-k">=</span> <span class="pl-c1">0.0</span>
    windmult <span class="pl-k">=</span> <span class="pl-c1">1.0</span>
    albedo_offset <span class="pl-k">=</span> <span class="pl-c1">0.0</span>
<span class="pl-c"><span class="pl-c">!</span> number of time steps to run</span>
    maxiter <span class="pl-k">=</span> <span class="pl-c1">6426</span>
<span class="pl-c"><span class="pl-c">!</span> set start year</span>
    yeararg <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>1995<span class="pl-pds">"</span></span>
<span class="pl-k">/</span></pre></div>
<p>The values for <code>z_0</code>, <code>dz1</code>, <code>n_snowgrain_radius</code> in the above example correspond to the parameterization of the model by MJH in Hoffman 2016.</p>
<p>The values for <code>glacnum</code>, <code>runmin</code>, and <code>runmax</code> correspond to a spatial configuration of the model.</p>
<p>The values for parameters <code>tempadd</code>, <code>windmult</code>, and <code>albedo_offset</code> correspond to no adjustments to the input met data.</p>
<p>The values for parameters <code>maxiter</code> and <code>yeararg</code> correspond with a configuration of the model to run accross the entire MicroMet period with data, from July 1st 1995 to February 1st 2013 (e.g. 6426 days).</p>
<h5>
<a id="user-content-required-parameters" class="anchor" href="#required-parameters" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Required Parameters:</h5>
<ul>
<li>
<code>glacnum</code> Specifies the run type (e.g. station or spatial).</li>
<li>
<code>z_0</code>: Surface roughness length.</li>
<li>
<code>dz1</code>: The thickness of the darkened surface layer.</li>
<li>
<code>n_snowgrain_radius</code>: The address of specified snow grain radius in an index.</li>
</ul>
<div class="highlight highlight-source-fortran-modern"><pre><span class="pl-c"><span class="pl-c">!</span> These are the possible radii (mm) that can be used for the model simulations.</span>
      <span class="pl-k">data</span> radii<span class="pl-k">/</span><span class="pl-c1">0.005</span>, <span class="pl-c1">0.007</span>, <span class="pl-c1">0.010</span>, <span class="pl-c1">0.015</span>, <span class="pl-c1">0.020</span>, &amp;
                 <span class="pl-c1">0.030</span>, <span class="pl-c1">0.040</span>, <span class="pl-c1">0.050</span>, <span class="pl-c1">0.065</span>, <span class="pl-c1">0.080</span>, &amp;
                 <span class="pl-c1">0.100</span>, <span class="pl-c1">0.120</span>, <span class="pl-c1">0.140</span>, <span class="pl-c1">0.170</span>, <span class="pl-c1">0.200</span>, &amp;
                 <span class="pl-c1">0.240</span>, <span class="pl-c1">0.290</span>, <span class="pl-c1">0.350</span>, <span class="pl-c1">0.420</span>, <span class="pl-c1">0.500</span>, &amp;
                 <span class="pl-c1">0.570</span>, <span class="pl-c1">0.660</span>, <span class="pl-c1">0.760</span>, <span class="pl-c1">0.870</span>, <span class="pl-c1">1.000</span>, &amp;
                 <span class="pl-c1">1.100</span>, <span class="pl-c1">1.250</span>, <span class="pl-c1">1.400</span>, <span class="pl-c1">1.600</span>, <span class="pl-c1">1.800</span>, &amp;
                 <span class="pl-c1">2.000</span>, <span class="pl-c1">2.500</span>, <span class="pl-c1">3.000</span>, <span class="pl-c1">3.500</span>, <span class="pl-c1">4.000</span>, &amp;
                 <span class="pl-c1">4.500</span>, <span class="pl-c1">5.000</span>, <span class="pl-c1">5.500</span>, <span class="pl-c1">6.000</span>, <span class="pl-c1">6.500</span>, &amp;
                 <span class="pl-c1">7.000</span>, <span class="pl-c1">7.500</span>, <span class="pl-c1">8.000</span>, <span class="pl-c1">8.500</span>, <span class="pl-c1">9.000</span>, &amp;
                 <span class="pl-c1">9.500</span>,<span class="pl-c1">10.000</span><span class="pl-k">/</span></pre></div>
<ul>
<li>
<code>runmin</code>: Minimum value of the range of model basins to run, the lowest being 10. Can be set to -999 to prevent spatial run. (An index value)</li>
<li>
<code>runmax</code>: Maximum value of the range of model basins to run, the maximum being 82. Can be set to -999 to prevent spatial run. (An index value)</li>
<li>
<code>runnametext</code>: User specified name within full run name (see notes on output folder name below).</li>
</ul>
<h5>
<a id="user-content-optional-adjustments-to-met-data" class="anchor" href="#optional-adjustments-to-met-data" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Optional adjustments to met data:</h5>
<ul>
<li>
<code>tempadd</code>: added globally to input air temperature data.</li>
<li>
<code>windmult</code>: multiplier applied to input wind speed data.</li>
<li>
<code>albedo_offset</code>: offset applied to input albedo data.</li>
</ul>
<h5>
<a id="user-content-temporal-parameters" class="anchor" href="#temporal-parameters" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Temporal parameters:</h5>
<ul>
<li>
<code>maxiter</code>: The number of daily time steps in the model run.  If an hourly step is used, they are addressed within the model, and maxiter should still equal the number of daily time steps.</li>
<li>
<code>yeararg</code>: This controls which year the model starts on, so if this is adjusted the <code>maxiter</code> parameter will likely need to be as well.</li>
</ul>
<h5>
<a id="user-content-other-parameters" class="anchor" href="#other-parameters" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Other parameters:</h5>
<p>These are not controlled by the <code>namelist.input</code> file but are set internally in the model.</p>
<ul>
<li>
<code>nz</code>: The number of cells in the ice subsurface down to 15 m. This parameter also dictates the size of each cell.</li>
<li>
<code>ndarklayers</code>: the number of surface layers of the air-ice interface that interactvs with the atmosphere over the time step (related to Chi in Hoffman et al. 2008)</li>
<li>
<code>drain_thresh</code>: the water fraction at which water is removed from the subsurface.</li>
<li>
<code>J_day_start</code>: Start Date (Julian calendar) = 182 (July 1), which is ideal since it initiates the model at a time low melt.</li>
<li>
<code>dt</code> (Time step): 3600 s (hourly), 86400 s (daily)</li>
</ul>
<h5>
<a id="user-content-output-control-parameters" class="anchor" href="#output-control-parameters" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Output control parameters:</h5>
<ul>
<li>
<code>iwritehourlymelt</code>: controls how often output is written.  1 = hourly.  0 = daily.</li>
</ul>
<h2>
<a id="user-content-input-files" class="anchor" href="#input-files" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a name="user-content-input_files"></a>Input Files</h2>
<h5>
<a id="user-content-required-for-stationary-run" class="anchor" href="#required-for-stationary-run" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Required for Stationary Run:</h5>
<ul>
<li>
<code>STN_stn.bin</code>: binary hourly met input file for each met station (Unit 32).
<ul>
<li>Includes: TAR, HOD, COH, CAA, BFS, LHC</li>
</ul>
</li>
<li>
<code>9513_alb.STN</code>: ASCII (text) input daily albedo file for each run case (Unit 33)
<ul>
<li>Includes: TAR, CAA, clf, AVG</li>
</ul>
</li>
<li>
<code>icetempinit.txt</code>: optional text file that initializes subsurfce temperatures, precluding the need to run multiple annual iterations to equilibrate the ice tmperature.</li>
</ul>
<h5>
<a id="user-content-required-for-spatial-run" class="anchor" href="#required-for-spatial-run" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Required for Spatial Run:</h5>
<ul>
<li>
<code>XXXYYY.bin</code>: binary MicroMet input file for each glacier cell (Unit 31).
<ul>
<li>Includes: 1300 cells with names formatted as X (000), Y (000) location</li>
</ul>
</li>
<li>
<code>tv_basins_cliff.txt</code>: ASCII input landcover type for cliff run (Unit 50)</li>
<li>
<code>tv_basins_surface.txt</code>: ASCII input landcover type for smooth surface run (Unit 50)</li>
<li>
<code>tv_dem250.txt</code>: ASCII input DEM (Unit 51)</li>
<li>
<code>T_avg_all.txt</code>: ASCII input temperature file (Unit 52)</li>
</ul>
<h2>
<a id="user-content-output-files" class="anchor" href="#output-files" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a name="user-content-output_files"></a>Output Files</h2>
<ul>
<li>Binary (.bin) files can be read using <code>float32</code> format.</li>
<li>When reading data, the number of rows in the array will depend on the value of nz used in the model.</li>
<li>Output array is structured so the variables are written by row and each column represents a point in time.</li>
<li>The prefix of output file names indicates the grid cell in 'model space' (could be met station location or uninstrumented glacier cell)</li>
</ul>
<h5>
<a id="user-content-output-folder-name" class="anchor" href="#output-folder-name" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Output Folder Name:</h5>
<ul>
<li>E.g. <code>TAR_NAME_0.0100000_0.0001_10</code>
</li>
<li>A concatenation of the <code>glaccode</code>, <code>runname</code>, and other input parameters (e.g. <code>z_0</code>, <code>delta z</code>, <code>snow grain radius</code>)</li>
<li>The runname is set in the namelist.input file, in this case <code>runnametext = "NAME"</code>
</li>
</ul>
<h5>
<a id="user-content-station-run-output-files-referred-to-as-detailed-output-in-model" class="anchor" href="#station-run-output-files-referred-to-as-detailed-output-in-model" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Station run output files (referred to as detailed output in model):</h5>
<ul>
<li>
<code>053036.out</code>: binary unformated file
<ul>
<li>Meteorologic and energy balance output varaiables (20)</li>
<li>Stored in array <code>xdataout</code> with dimensions <code>[20,175000]</code>
</li>
<li>Accessed using unit (28)</li>
<li>Each of the 20 columns are listed below with corresponding variable:</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th align="center">Column #</th>
<th align="center">Variable</th>
<th align="center">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">1</td>
<td align="center">timestep</td>
<td align="center">Hourly timestep</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">Tair - Tf</td>
<td align="center">Air temp. minus the freezing point of water</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">Tsfc - Tf</td>
<td align="center">Surface temp. minus the freezing point of water</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">Qsi</td>
<td align="center">Incoming shortwave radiation flux</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">Qli</td>
<td align="center">Incoming longwave radiation flux</td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">Qle</td>
<td align="center">Outgoing longwave radiation flux</td>
</tr>
<tr>
<td align="center">7</td>
<td align="center">Qh</td>
<td align="center">Latent energy flux</td>
</tr>
<tr>
<td align="center">8</td>
<td align="center">Qe</td>
<td align="center">Sensible energy flux</td>
</tr>
<tr>
<td align="center">9</td>
<td align="center">Qc</td>
<td align="center">Conduction heat flux</td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">Qm</td>
<td align="center">Energy available for melt</td>
</tr>
<tr>
<td align="center">11</td>
<td align="center">balance</td>
<td align="center">Energy balance</td>
</tr>
<tr>
<td align="center">12</td>
<td align="center">albedo</td>
<td align="center">Albedo</td>
</tr>
<tr>
<td align="center">13</td>
<td align="center">stability</td>
<td align="center">Stability</td>
</tr>
<tr>
<td align="center">14</td>
<td align="center">surface melt</td>
<td align="center">Melt at surface</td>
</tr>
<tr>
<td align="center">15</td>
<td align="center">ablation</td>
<td align="center">Ablation at surface</td>
</tr>
<tr>
<td align="center">16</td>
<td align="center">snow</td>
<td align="center">Snow depth at surface</td>
</tr>
<tr>
<td align="center">17</td>
<td align="center">water depth</td>
<td align="center">Water column depth</td>
</tr>
<tr>
<td align="center">18</td>
<td align="center">water flux</td>
<td align="center">Water flux out of ice column at surface</td>
</tr>
<tr>
<td align="center">19</td>
<td align="center">subdrain</td>
<td align="center">Water flux out of ice column subsurface</td>
</tr>
<tr>
<td align="center">20</td>
<td align="center">wind speed</td>
<td align="center">Windspeed</td>
</tr>
</tbody>
</table>
<ul>
<li>
<code>053036.densityprofile</code>: ASCII text format file
<ul>
<li>This is a file to write out the end of summer density profile for each year</li>
<li>Stored in array 'endofsummerdensity' with dimensions <code>[30]</code>
</li>
<li>Writes just the upper 30 layers for each year (on January 31, the approx. end of summer  date)</li>
<li>Default density of ice and snow assumed to be 870 kg m-3</li>
<li>Accessed using unit (66)</li>
</ul>
</li>
</ul>
<h5>
<a id="user-content-spatial-run-output-files-referred-to-as-general-output-in-model" class="anchor" href="#spatial-run-output-files-referred-to-as-general-output-in-model" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Spatial Run Output Files (referred to as general output in model):</h5>
<ul>
<li>
<p><code>053036.ablation.hourly</code>: binary unformatted file</p>
<ul>
<li>This is a file to write out surface melt, ablation, and drained subsurface melt hourly</li>
<li>Stored in variables <code>surface_melt</code>, <code>ablation</code>, <code>submelt</code>.</li>
<li>Output array has dimensions of <code>[3,175000]</code>
</li>
<li>This is optionally switched on and off at <code>iwritehourlymelt</code>
</li>
<li>Accessed using unit (21)</li>
</ul>
</li>
<li>
<p><code>053036.ablation.daily</code>: binary unformatted file</p>
<ul>
<li>This is a file to write out surface melt, ablation, and drained subsurface melt daily</li>
<li>Stored in variables <code>daymelt</code>, <code>dayablation</code>, and <code>daysubdrain</code> which are then stored in array <code>day_melt_abl_out</code> with dimensions <code>[3,7000]</code>
</li>
<li>Accessed using unit (20)</li>
</ul>
</li>
</ul>
<h5>
<a id="user-content-other-output-files" class="anchor" href="#other-output-files" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Other Output Files:</h5>
<ul>
<li>
<p><code>downupext.out</code>: ASCII text format file</p>
<ul>
<li>Energy downwelling and upwelling based on extinction coefficient, feeds back into model as initial conditions of subsequent runs.</li>
<li>First line is incoming solar radiation</li>
<li>Next 73 lines are for depths as per ycrds.out down to 15 meters.</li>
<li>Accessed using unit (24)</li>
</ul>
</li>
<li>
<p><code>qsfactor</code>: ASCII text format file</p>
<ul>
<li>Single value, used for output processing</li>
<li>Calculated in <code>DARKENLAYERS</code> subroutine.</li>
<li>This subroutine automatically calculates what % of the net Qs to eliminate from the SEB based on how many layers you want to black out.</li>
</ul>
</li>
<li>
<p><code>ycrds.out</code>: ASCII text format file</p>
<ul>
<li>Writes the coordinate system used for the T points, excluding boundaries.</li>
<li>Accessed using unit (24)</li>
</ul>
</li>
<li>
<p><code>downup.OUT</code>: ASCII text format file</p>
<ul>
<li>This is the full output for downwelling and upwelling energy at every depth.</li>
<li>Variables include depth (meters), downwelling energy, upwelling energy, and the difference between up and downwelling</li>
<li>Optional output of down and up streams.  This is useful for getting around the variable deltaz problem: Set deltaz to be constant, output down &amp; up, change deltaz back to the desired values, then read down &amp; up in to bypass their calculation."</li>
<li>Accessed using unit (24)</li>
</ul>
</li>
<li>
<p><code>053036.subsurf</code>: binary unformatted file</p>
<ul>
<li>Array with dimensions <code>[100]</code>
</li>
<li>Still not sure what this file is, but it has to do with temperature and water fraction.</li>
</ul>
</li>
</ul>
<h2>
<a id="user-content-post-processing-scripts" class="anchor" href="#post-processing-scripts" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a name="user-content-postprocess"></a>Post-processing Scripts</h2>
<h2>
<a id="user-content-attribution" class="anchor" href="#attribution" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a name="user-content-attribution"></a>Attribution</h2>
<h5>
<a id="user-content-author-of-original-code-is" class="anchor" href="#author-of-original-code-is" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Author of original code is:</h5>
<ul>
<li>Dr. Glen E. Liston<br>
InterWorks Consulting<br>
15048 NCR 25E<br>
Loveland, Colorado 80538</li>
</ul>
<p>The general model equations are described in the paper:</p>
<ul>
<li>Below-surface ice melt on the coastal Antarctic ice sheet, by Glen E. Liston and 4 others, Journal of Glaciology, 1999, Vol. 45, No. 150, pages 273-285.</li>
</ul>
<h5>
<a id="user-content-modifications-to-the-orginal-code-by" class="anchor" href="#modifications-to-the-orginal-code-by" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Modifications to the orginal code by:</h5>
<ul>
<li>Dr. Matthew J. Hoffman<br>
Department of Geology,<br>
Portland State University,<br>
Portland, Oregon 97201</li>
</ul>
<p>For details on Hoffman model, see:</p>
<ul>
<li>Hoffman et al. 2008</li>
<li>Hoffman et al. 2014</li>
<li>Hoffman et al. 2016</li>
</ul>
<h5>
<a id="user-content-subsequent-modifications-to-hoffman-code-by" class="anchor" href="#subsequent-modifications-to-hoffman-code-by" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Subsequent modifications to Hoffman code by:</h5>
<ul>
<li>Julian M. Cross<br>
Department of Geography,<br>
Portland State University,<br>
Portland, Oregon 97201</li>
</ul>
<h2>
<a id="user-content-appendix" class="anchor" href="#appendix" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a name="user-content-appendix"></a>Appendix</h2>
<h5>
<a id="user-content-data-dictionary" class="anchor" href="#data-dictionary" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Data Dictionary</h5>
<p>Comments and notes developed by Felix Zamora on 10/11/2017 and subsequent contributuions by Julian Cross on 6/28/2018.</p>
<div class="highlight highlight-source-fortran-modern"><pre><span class="pl-c"><span class="pl-c">!</span> data dictionary</span>
    <span class="pl-k">integer</span> <span class="pl-k">::</span> ablation_output   <span class="pl-c"><span class="pl-c">!</span> ablation</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> albedo_evo_poly_a,albedo_evo_poly_b,albedo_evo_poly_c 
        <span class="pl-c"><span class="pl-c">!</span> constants for calculating the best fit polynomial of albedo.</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> albedo_evo_poly_d,snow_albedo_thresh
    <span class="pl-k">character</span><span class="pl-k">*</span>(<span class="pl-c1">31</span>) <span class="pl-k">::</span> albedo_file       <span class="pl-c"><span class="pl-c">!</span> albedo input data from met stations</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> albedo_water   <span class="pl-c"><span class="pl-c">!</span> albedo of water</span>
    <span class="pl-k">character</span><span class="pl-k">*</span>(<span class="pl-c1">6</span>) <span class="pl-k">::</span> c_deltaz1    
        <span class="pl-c"><span class="pl-c">!</span> placeholder for deltaz value when writing run name</span>
    <span class="pl-k">character</span><span class="pl-k">*</span>(<span class="pl-c1">80</span>) <span class="pl-k">::</span> c_md_string   
        <span class="pl-c"><span class="pl-c">!</span> shell commands for DOS or Linux environments</span>
    <span class="pl-k">character</span><span class="pl-k">*</span>(<span class="pl-c1">2</span>) <span class="pl-k">::</span> c_snowgrain_radius  
        <span class="pl-c"><span class="pl-c">!</span> placeholder for snowgrain radius when building filename</span>
    <span class="pl-k">character</span><span class="pl-k">*</span>(<span class="pl-c1">4</span>) <span class="pl-k">::</span> c_year         
        <span class="pl-c"><span class="pl-c">!</span> placeholder for year start when building filename</span>
    <span class="pl-k">character</span><span class="pl-k">*</span>(<span class="pl-c1">2</span>) <span class="pl-k">::</span> c_yearstart  <span class="pl-c"><span class="pl-c">!</span> placeholder when building filename</span>
    <span class="pl-k">character</span><span class="pl-k">*</span>(<span class="pl-c1">2</span>) <span class="pl-k">::</span> c_yearend      <span class="pl-c"><span class="pl-c">!</span> placeholder when building filename</span>
    <span class="pl-k">character</span><span class="pl-k">*</span>(<span class="pl-c1">9</span>) <span class="pl-k">::</span> c_z_0      
        <span class="pl-c"><span class="pl-c">!</span> placeholder for z_0 value when writing run name</span>
    <span class="pl-k">character</span><span class="pl-k">*</span>(<span class="pl-c1">80</span>) <span class="pl-k">::</span> cjunk   
        <span class="pl-c"><span class="pl-c">!</span> shell variable to read through input file headers</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> Cp_air      
        <span class="pl-c"><span class="pl-c">!</span> Specific heat capacity of air (SUBROUTINE: CONSTS_ICE)</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> D_e, D_h        
        <span class="pl-c"><span class="pl-c">!</span> Exchange coefficient of sensible and latent heat (eq. A14, SUBROUTINES: EXCOEFS, EXCOEFS_SCALAR)</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> day_melt_abl_out(<span class="pl-c1">3</span>,<span class="pl-c1">7000</span>)   
        <span class="pl-c"><span class="pl-c">!</span> output array for daily melt, ablation, and drainage</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> dt      <span class="pl-c"><span class="pl-c">!</span> model time steps; day=86400, hr=3600 sec.</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> dz1, drainthresh, tempadd, windmult, albedo_offset
    <span class="pl-k">real</span> <span class="pl-k">::</span> ea          
        <span class="pl-c"><span class="pl-c">!</span> Vapor pressure at reference height (SUBROUTINE: VAPPRESS)</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> emiss_sfc  <span class="pl-c"><span class="pl-c">!</span> surface emissivity of snow/ice</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> endofsummerdensity(JJ)  <span class="pl-c"><span class="pl-c">!</span> ice density updated each season</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> es0         <span class="pl-c"><span class="pl-c">!</span> Vapor pressure at ice surface (SUBROUTINE: VAPOR)</span>
    <span class="pl-k">character</span><span class="pl-k">*</span>(<span class="pl-c1">3</span>) <span class="pl-k">::</span> glaccode  <span class="pl-c"><span class="pl-c">!</span> glacier code</span>
    <span class="pl-k">integer</span> <span class="pl-k">::</span> glacnum  <span class="pl-c"><span class="pl-c">!</span> used to delcare run type</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> gravity     <span class="pl-c"><span class="pl-c">!</span> gravitational acceleration</span>
    <span class="pl-k">integer</span> <span class="pl-k">::</span> hr     <span class="pl-c"><span class="pl-c">!</span> hour of day</span>
    <span class="pl-k">integer</span> <span class="pl-k">::</span> i2,j2,iarraypos   
        <span class="pl-c"><span class="pl-c">!</span> array position variables for met station and pressure data.</span>
    <span class="pl-k">integer</span> <span class="pl-k">::</span> ierr     <span class="pl-c"><span class="pl-c">!</span> i/o error code</span>
    <span class="pl-k">integer</span> <span class="pl-k">::</span> immstart(<span class="pl-c1">2</span>,<span class="pl-c1">28</span>), immoffset
    <span class="pl-k">integer</span> <span class="pl-k">::</span> ihrs_day     <span class="pl-c"><span class="pl-c">!</span> hours in a day (SUBROUTINE: CONSTS)</span>
    <span class="pl-k">real</span>, <span class="pl-k">dimension</span> (<span class="pl-c1">10</span>,<span class="pl-c1">1000</span>) <span class="pl-k">::</span> input_met   <span class="pl-c"><span class="pl-c">!</span> meteorologic input array</span>
    <span class="pl-k">integer</span> <span class="pl-k">::</span> i_yearstart      <span class="pl-c"><span class="pl-c">!</span> Starting year</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> lamp_dist
    <span class="pl-k">integer</span> <span class="pl-k">::</span> maxiter
    <span class="pl-c"><span class="pl-c">!</span> maxiter is the number of DAILY time steps in the model run.</span>
    <span class="pl-c"><span class="pl-c">!</span> parameter (maxiter=365)</span>
    <span class="pl-c"><span class="pl-c">!</span> parameter (maxiter=1)</span>
    <span class="pl-c"><span class="pl-c">!</span> replace this with leap year check below</span>
    <span class="pl-k">integer</span> <span class="pl-k">::</span> n_snowgrain_radius   <span class="pl-c"><span class="pl-c">!</span> snow grain radius</span>
    <span class="pl-k">character</span><span class="pl-k">*</span>(<span class="pl-c1">80</span>) <span class="pl-k">::</span> nlfname     <span class="pl-c"><span class="pl-c">!</span> name list file name??</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> one_atmos   <span class="pl-c"><span class="pl-c">!</span> One atmosphere (Subroutine: CONSTS)</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> Pa      
        <span class="pl-c"><span class="pl-c">!</span> Atmospheric pressure when met. data is unavailable (Subroutine: PRESSURE)</span>
    <span class="pl-k">character</span><span class="pl-k">*</span>(<span class="pl-c1">26</span>) <span class="pl-k">::</span> Pa_file   <span class="pl-c"><span class="pl-c">!</span> Lake Hoare Atmospheric pressure file</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> Qe    <span class="pl-c"><span class="pl-c">!</span> Sensible energy</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> Qh      <span class="pl-c"><span class="pl-c">!</span> Latent energy</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> Qsi   <span class="pl-c"><span class="pl-c">!</span> Incoming shortwave energy (SUBROUTINE: SHORTWAVE)</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> Qsip  <span class="pl-c"><span class="pl-c">!</span> Incoming shortwave energy that's penetrated the ice</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> R           <span class="pl-c"><span class="pl-c">!</span> used in ro_air calculation</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> real_Ma <span class="pl-c"><span class="pl-c">!</span> used in ro_air calculation</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> rh      <span class="pl-c"><span class="pl-c">!</span> relative humidity from meteorologic data</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> ro_air  <span class="pl-c"><span class="pl-c">!</span> Air density</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> ro_ice  <span class="pl-c"><span class="pl-c">!</span> Ice density ** Not updated with each time step ** Endofsummerdensity is used for that for some reason.</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> ro_water<span class="pl-c"><span class="pl-c">!</span> Water density</span>
    <span class="pl-k">integer</span> <span class="pl-k">::</span> runmin, runmax       <span class="pl-c"><span class="pl-c">!</span> control which basins to run</span>
    <span class="pl-k">character</span><span class="pl-k">*</span>(<span class="pl-c1">80</span>) <span class="pl-k">::</span> runnametext       <span class="pl-c"><span class="pl-c">!</span>  run name</span>
    <span class="pl-k">character</span><span class="pl-k">*</span>(<span class="pl-c1">80</span>) <span class="pl-k">::</span> runname               <span class="pl-c"><span class="pl-c">!</span>  also run name</span>
    <span class="pl-k">integer</span> <span class="pl-k">::</span> status   <span class="pl-c"><span class="pl-c">!</span> I/O status</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> Stef_Boltz  <span class="pl-c"><span class="pl-c">!</span> Stefan Boltzman constant</span>
    <span class="pl-k">character</span><span class="pl-k">*</span>(<span class="pl-c1">80</span>) <span class="pl-k">::</span> stn_met_file  <span class="pl-c"><span class="pl-c">!</span> Meteorologic station input file</span>
    <span class="pl-k">integer</span> <span class="pl-k">::</span> stnx(<span class="pl-c1">8</span>),stny(<span class="pl-c1">8</span>)   <span class="pl-c"><span class="pl-c">!</span> station xxx and yyy postion</span>
    <span class="pl-k">integer</span> <span class="pl-k">::</span> strlen   <span class="pl-c"><span class="pl-c">!</span> placeholder for string length when writing run names</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> Tair        <span class="pl-c"><span class="pl-c">!</span> Temperature at reference height</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> Tannualmean(nx,ny)  
        <span class="pl-c"><span class="pl-c">!</span> mean annual air temperature for given grid cell</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> Tf      <span class="pl-c"><span class="pl-c">!</span> Freezing point of water (SUBROUTINE: CONSTS_ICE)  Units in Kelvin??</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> time    <span class="pl-c"><span class="pl-c">!</span> time</span>
    <span class="pl-k">double precision</span> <span class="pl-k">::</span> totalheat,totalheat2 <span class="pl-c"><span class="pl-c">!</span> total heat in (SUBROUTINE: ICE_ENERGY)</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> Tsfc        <span class="pl-c"><span class="pl-c">!</span> Temperature at surface</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> water_frac(JJ<span class="pl-c1">+2</span>)             <span class="pl-c"><span class="pl-c">!</span> Water fraction of current time step</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> water_frac_old(JJ<span class="pl-c1">+2</span>)         <span class="pl-c"><span class="pl-c">!</span> Water fraction of previous time step</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> windspd     <span class="pl-c"><span class="pl-c">!</span> The wind speed at reference height (zr)</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> xdur        <span class="pl-c"><span class="pl-c">!</span> program run time</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> xinternal_heating_corr   <span class="pl-c"><span class="pl-c">!</span> Internal Heating Correction.  Multiplies internal heat from solar rad by a factor</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> xk_ice  <span class="pl-c"><span class="pl-c">!</span> Thermal conductivity of ice (Table 9.1 Cuffey &amp; Patterson 2010)</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> xkappa  <span class="pl-c"><span class="pl-c">!</span> Von Karman's constant.  Equal to 0.4 in (SUBROUTINE CONSTS)</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> xLs     <span class="pl-c"><span class="pl-c">!</span> Latent heat of fusion of ice (Subroutine: CONSTS_ICE)</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> xmmdata(<span class="pl-c1">6</span>,<span class="pl-c1">175000</span>),xstndata(<span class="pl-c1">6</span>,<span class="pl-c1">175000</span>),xpadata(<span class="pl-c1">2</span>,<span class="pl-c1">175000</span>)  <span class="pl-c"><span class="pl-c">!</span> micromet, station, and atmospheric pressure input arrays</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> xdataout(<span class="pl-c1">30</span>,<span class="pl-c1">175000</span>),subout(<span class="pl-c1">100</span>)   <span class="pl-c"><span class="pl-c">!</span> general output data array, output array for water fraction??</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> y_crds(JJ<span class="pl-c1">+2</span>)  <span class="pl-c"><span class="pl-c">!</span> not sure but do not delete since it's everywhere</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> y_wall(JJ<span class="pl-c1">+2</span>)  <span class="pl-c"><span class="pl-c">!</span> not sure but do not delete since it's everywhere</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> year    <span class="pl-c"><span class="pl-c">!</span> year</span>
    <span class="pl-k">character</span><span class="pl-k">*</span>(<span class="pl-c1">4</span>) <span class="pl-k">::</span> yeararg   <span class="pl-c"><span class="pl-c">!</span> text of year, which is then converted to a real number</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> z0          <span class="pl-c"><span class="pl-c">!</span> Momentum surface roughness length, assumed to be 10^-4 although Patterson et al. say .01-.1</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> z_windobs   <span class="pl-c"><span class="pl-c">!</span> Reference height of wind speed observation</span>
    <span class="pl-k">integer</span> <span class="pl-k">::</span> nz,JJ,nx,ny  <span class="pl-c"><span class="pl-c">!</span> number of cells in z-dir, cell number (),</span>
    <span class="pl-k">parameter</span> <span class="pl-k">::</span> (nz<span class="pl-k">=</span><span class="pl-c1">70</span>) <span class="pl-c"><span class="pl-c">!</span>170, 37, 71, 70</span>
    <span class="pl-k">parameter</span> <span class="pl-k">::</span> (JJ<span class="pl-k">=</span>nz)   <span class="pl-c"><span class="pl-c">!</span> ice cell number. increases with depth.  used in do loops.</span>
    <span class="pl-k">parameter</span> <span class="pl-k">::</span> (nx<span class="pl-k">=</span><span class="pl-c1">200</span>)  <span class="pl-c"><span class="pl-c">!</span> cell x coordinate</span>
    <span class="pl-k">parameter</span> <span class="pl-k">::</span> (ny<span class="pl-k">=</span><span class="pl-c1">140</span>)    <span class="pl-c"><span class="pl-c">!</span> cell y coordiante</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> deltaz(nz)          <span class="pl-c"><span class="pl-c">!</span> cell thickness @ nz</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> gamma(JJ<span class="pl-c1">+2</span>)   <span class="pl-c"><span class="pl-c">!</span> gamma </span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> f_n(JJ<span class="pl-c1">+2</span>)     <span class="pl-c"><span class="pl-c">!</span> used in gamma calculation</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> dely_p(JJ<span class="pl-c1">+2</span>)  <span class="pl-c"><span class="pl-c">!</span> distance between pressure grid points used in control volume calculation.</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> dy_p(JJ<span class="pl-c1">+2</span>)    <span class="pl-c"><span class="pl-c">!</span> maximum amount of ice available to melt (equal to deltaz)</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> T_old(JJ<span class="pl-c1">+2</span>)   <span class="pl-c"><span class="pl-c">!</span> temperature of cell during previous timestep</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> xmelt(JJ<span class="pl-c1">+2</span>)   <span class="pl-c"><span class="pl-c">!</span> amount of water produced by the energy represented by the temperature above freezing.</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> up(JJ<span class="pl-c1">+2</span>)        <span class="pl-c"><span class="pl-c">!</span> updward solar radiation</span>
    <span class="pl-k">real</span> <span class="pl-k">::</span> down(JJ<span class="pl-c1">+2</span>)      <span class="pl-c"><span class="pl-c">!</span> downward solar radiation</span></pre></div>
</article></body></html>